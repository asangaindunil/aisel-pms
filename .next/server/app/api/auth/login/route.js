"use strict";(()=>{var e={};e.id=873,e.ids=[873],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},7772:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>b,patchFetch:()=>v,requestAsyncStorage:()=>c,routeModule:()=>h,serverHooks:()=>f,staticGenerationAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{POST:()=>p});var i=r(9303),n=r(8716),a=r(670),o=r(2023),u=r.n(o),d=r(8990),l=r(5183),m=r(4235);async function p(e){try{let t=await e.json(),r=m.d.safeParse(t);if(!r.success)return Response.json({success:!1,error:"Invalid input",message:r.error.errors[0].message},{status:400});let{username:s,password:i}=r.data,n=d.F.getUserByUsername(s);if(!n||!await u().compare(i,n.passwordHash))return Response.json({success:!1,error:"Invalid credentials"},{status:401});let a=(0,l.fT)({userId:n.id,username:n.username,role:n.role}),{...o}=n;return Response.json({success:!0,data:{token:a,user:o}})}catch(e){return console.error("Login error:",e),Response.json({success:!1,error:"Internal server error"},{status:500})}}let h=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/Users/asangaindunil/Documents/aisel-pms/src/app/api/auth/login/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:c,staticGenerationAsyncStorage:g,serverHooks:f}=h,b="/api/auth/login/route";function v(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:g})}},8990:(e,t,r)=>{r.d(t,{F:()=>a});var s=r(2023),i=r.n(s);class n{constructor(){this.patients=[],this.users=[],this.patientIdCounter=1,this.userIdCounter=1,this.initialized=!1,this.init()}async init(){if(!this.initialized)try{let[e,t]=await Promise.all([i().hash("admin123",10),i().hash("user123",10)]),r=new Date().toISOString();this.users=[{id:this.userIdCounter++,username:"admin",role:"admin",createdAt:r,passwordHash:e},{id:this.userIdCounter++,username:"user",role:"user",createdAt:r,passwordHash:t}],this.patients=[{id:1,firstName:"John",lastName:"Doe",email:"john.doe@email.com",phoneNumber:"+1234567890",dob:"1985-06-15",createdAt:r,updatedAt:r},{id:2,firstName:"Jane",lastName:"Smith",email:"jane.smith@email.com",phoneNumber:"+1987654321",dob:"1990-03-22",createdAt:r,updatedAt:r},{id:3,firstName:"Michael",lastName:"Johnson",email:"michael.johnson@email.com",phoneNumber:"+1122334455",dob:"1978-11-08",createdAt:r,updatedAt:r}],this.patientIdCounter=this.patients.length+1,this.initialized=!0}catch(e){console.error("Failed to initialize database:",e)}}getAllPatients(){return[...this.patients]}getPatientById(e){return this.patients.find(t=>t.id===e)??null}createPatient(e){let t=new Date().toISOString(),r={id:this.patientIdCounter++,...e,createdAt:t,updatedAt:t};return this.patients.push(r),r}updatePatient(e,t){let r=this.patients.find(t=>t.id===e);return r?(Object.assign(r,t,{updatedAt:new Date().toISOString()}),r):null}deletePatient(e){let t=this.patients.findIndex(t=>t.id===e);return -1!==t&&(this.patients.splice(t,1),!0)}getUserByUsername(e){return this.users.find(t=>t.username===e)??null}getUserById(e){let t=this.users.find(t=>t.id===e);if(!t)return null;let{...r}=t;return r}}let a=new n},5183:(e,t,r)=>{r.d(t,{WX:()=>o,fT:()=>a,oA:()=>u});var s=r(1482),i=r.n(s);let n=process.env.JWT_SECRET||"prod-secret";function a(e){return i().sign(e,n,{expiresIn:"7d"})}function o(e){try{return i().verify(e,n)}catch{return null}}function u(e){return e&&e.startsWith("Bearer ")?e.substring(7):null}},4235:(e,t,r)=>{r.d(t,{Q:()=>i,d:()=>n});var s=r(9133);let i=s.z.object({firstName:s.z.string().min(1,"First name is required").max(50,"First name too long"),lastName:s.z.string().min(1,"Last name is required").max(50,"Last name too long"),email:s.z.string().email("Invalid email address"),phoneNumber:s.z.string().min(10,"Phone number must be at least 10 digits").max(15,"Phone number too long"),dob:s.z.string().refine(e=>{let t=new Date(e);return!isNaN(t.getTime())&&t<new Date},"Invalid date of birth")}),n=s.z.object({username:s.z.string().min(1,"Username is required").trim(),password:s.z.string().min(1,"Password is required")})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,443,133],()=>r(7772));module.exports=s})();