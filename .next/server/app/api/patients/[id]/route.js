"use strict";(()=>{var e={};e.id=289,e.ids=[289],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},697:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>I,patchFetch:()=>P,requestAsyncStorage:()=>g,routeModule:()=>f,serverHooks:()=>y,staticGenerationAsyncStorage:()=>b});var s={};r.r(s),r.d(s,{DELETE:()=>h,GET:()=>c,PUT:()=>m});var i=r(9303),a=r(8716),n=r(670),u=r(2095),d=r(8990),o=r(4235);function l(e){if(!e||"string"!=typeof e.id)return null;let t=parseInt(e.id,10);return isNaN(t)||t<=0?null:t}function p(e,t=400,r={}){return Response.json({success:!1,error:e,...r},{status:t})}let c=(0,u.mk)(async(e,t,{params:r})=>{let s=l(r);if(!s)return p("Invalid patient ID");let i=null;try{i=d.F.getPatientById(s)}catch(e){return p("Database error",500,{details:e.message})}return i?Response.json({success:!0,data:i}):p("Patient not found",404)}),m=(0,u.kF)(async(e,t,{params:r})=>{let s;let i=l(r);if(!i)return p("Invalid patient ID");try{s=await e.json()}catch{return p("Invalid JSON body",400)}if(!s||"object"!=typeof s)return p("Request body must be an object",400);let a=o.Q.partial().safeParse(s);if(!a.success)return p("Invalid input",400,{message:a.error.errors[0]?.message||"Validation failed"});if(0===Object.keys(a.data).length)return p("No fields to update",400);if(a.data.email&&d.F.getAllPatients().some(e=>e.email===a.data.email&&e.id!==i))return p("Email already exists",409);let n=null;try{n=d.F.updatePatient(i,a.data)}catch(e){return p("Database error",500,{details:e.message})}return n?Response.json({success:!0,data:n,message:"Patient updated successfully"}):p("Patient not found",404)}),h=(0,u.kF)(async(e,t,{params:r})=>{let s=l(r);if(!s)return p("Invalid patient ID");let i=!1;try{i=d.F.deletePatient(s)}catch(e){return p("Database error",500,{details:e.message})}return i?Response.json({success:!0,message:"Patient deleted successfully"}):p("Patient not found",404)}),f=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/patients/[id]/route",pathname:"/api/patients/[id]",filename:"route",bundlePath:"app/api/patients/[id]/route"},resolvedPagePath:"/Users/asangaindunil/Documents/aisel-pms/src/app/api/patients/[id]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:b,serverHooks:y}=f,I="/api/patients/[id]/route";function P(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:b})}},2095:(e,t,r)=>{r.d(t,{kF:()=>d,mk:()=>u});var s=r(5183),i=r(8990);async function a(e){let t=(0,s.oA)(e.headers.get("authorization"));if(!t)return null;let r=(0,s.WX)(t);if(!r)return null;let a=await i.F.getUserById(r.userId);return!a||a.isDisabled?null:r}function n(e=!1){return t=>async(r,...s)=>{let i=await a(r);return i?e&&"admin"!==i.role?Response.json({success:!1,error:"Forbidden"},{status:403}):t(r,i,...s):Response.json({success:!1,error:"Unauthorized"},{status:401})}}let u=n(!1),d=n(!0)},8990:(e,t,r)=>{r.d(t,{F:()=>n});var s=r(2023),i=r.n(s);class a{async init(){if(!this.initialized)try{let[e,t]=await Promise.all([i().hash("admin123",10),i().hash("user123",10)]),r=new Date().toISOString();this.users=[{id:this.userIdCounter++,username:"admin",role:"admin",createdAt:r,isDisabled:!1,passwordHash:e},{id:this.userIdCounter++,username:"user",role:"user",createdAt:r,isDisabled:!1,passwordHash:t}],this.patients=[{id:1,firstName:"John",lastName:"Doe",email:"john.doe@email.com",phoneNumber:"+1234567890",dob:"1985-06-15",createdAt:r,updatedAt:r},{id:2,firstName:"Jane",lastName:"Smith",email:"jane.smith@email.com",phoneNumber:"+1987654321",dob:"1990-03-22",createdAt:r,updatedAt:r},{id:3,firstName:"Michael",lastName:"Johnson",email:"michael.johnson@email.com",phoneNumber:"+1122334455",dob:"1978-11-08",createdAt:r,updatedAt:r}],this.patientIdCounter=this.patients.length+1,this.initialized=!0}catch(e){console.error("Failed to initialize database:",e)}}getAllPatients(){return this.patients.map(({...e})=>({...e}))}getPatientById(e){let t=this.patients.find(t=>t.id===e);return t?{...t}:null}createPatient(e){let t=new Date().toISOString(),r={id:this.patientIdCounter++,...e,createdAt:t,updatedAt:t};return this.patients.push(r),{...r}}updatePatient(e,t){let r=this.patients.find(t=>t.id===e);return r?(Object.assign(r,t,{updatedAt:new Date().toISOString()}),{...r}):null}deletePatient(e){let t=this.patients.findIndex(t=>t.id===e);return -1!==t&&(this.patients.splice(t,1),!0)}getUserByUsername(e){return this.users.find(t=>t.username===e)??null}getUserById(e){let t=this.users.find(t=>t.id===e);if(!t)return null;let{...r}=t;return r}async createUser(e,t,r){if(this.users.some(t=>t.username===e))return null;let s=await i().hash(t,10),a=new Date().toISOString(),n={id:this.userIdCounter++,username:e,role:r,createdAt:a,isDisabled:!1,passwordHash:s};this.users.push(n);let{...u}=n;return u}constructor(){this.patients=[],this.users=[],this.patientIdCounter=1,this.userIdCounter=1,this.initialized=!1}}let n=new a},5183:(e,t,r)=>{r.d(t,{WX:()=>u,fT:()=>n,oA:()=>d});var s=r(1482),i=r.n(s);let a=process.env.JWT_SECRET||"prod-secret";function n(e){return i().sign(e,a,{expiresIn:"7d"})}function u(e){try{return i().verify(e,a)}catch{return null}}function d(e){return e&&e.startsWith("Bearer ")?e.substring(7):null}},4235:(e,t,r)=>{r.d(t,{Q:()=>i,d:()=>a});var s=r(9133);let i=s.z.object({firstName:s.z.string().min(1,"First name is required").max(50,"First name too long"),lastName:s.z.string().min(1,"Last name is required").max(50,"Last name too long"),email:s.z.string().email("Invalid email address"),phoneNumber:s.z.string().min(10,"Phone number must be at least 10 digits").max(15,"Phone number too long"),dob:s.z.string().refine(e=>{let t=new Date(e);return!isNaN(t.getTime())&&t<new Date},"Invalid date of birth")}),a=s.z.object({username:s.z.string().min(1,"Username is required").trim(),password:s.z.string().min(1,"Password is required")})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,443,133],()=>r(697));module.exports=s})();